<div style="margin-top: 60px" >
  <div style="display: flex; justify-content: space-between">
    <span class="user">
      Author: <%= link_to micropost.user.name, micropost.user %>
    </span>
      <span class="micropost-content">
      <% if current_user?(micropost.user) %>
        <%= link_to "delete post", micropost, data: {turbo_method: :delete,  turbo_confirm: "You sure?" } %>
      <% end %>
    </span>
  </div>
  <p class="content micropost-content">
    <%= micropost.content %>
  </p>
  <div style="width: 100px">
    <%= image_tag micropost.image if micropost.image.attached? %>
  </div>
  <p class="timestamp" style="float: right">
    Posted <%= time_ago_in_words(micropost.created_at) %> ago.
  </p>
  <div style="margin: 20px">
    <%= render "shared/comment_form" %>
  </div>
  <div style="margin: 20px">
    <div id="microposts">
      <% micropost.comments.each do |comment| %>
        <%= render "shared/comment", micropost: comment %>
      <% end %>
    </div>
  </div>
</div>


<script type="text/javascript">
    document.addEventListener("turbo:load", () => {
        let form = document.getElementById("comment-form");
        let textarea = document.getElementById("input-comment");

        form.addEventListener("turbo:submit-end", (event) => {
            if (event.detail.success) {  // Kiểm tra nếu submit thành công
                textarea.value = '';
                location.reload();
            }
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        var replyButtons = document.querySelectorAll('.reply-btn');
        var replyContainerForms = document.querySelectorAll('.reply-container-form');
        var replyForms = document.querySelectorAll('.reply-form');
        var replyTextAreaForms = document.querySelectorAll(".input-comment-reply")

        replyButtons.forEach(function(replyButton, index) {
            replyButton.addEventListener('click', function() {
                let replyContainerForm = replyContainerForms[index]

                if (replyContainerForm.style.display === 'none') {
                    replyContainerForm.style.display = 'block';
                } else {
                    replyContainerForm.style.display = 'none';
                }
            });

            let replyForm = replyForms[index]
            let replyTextArea = replyTextAreaForms[index];

            replyForm.addEventListener("turbo:submit-end", (event) => {
                if (event.detail.success) {
                    replyTextArea.value = '';
                    location.reload();
                }
            });
        });
    });
</script>
